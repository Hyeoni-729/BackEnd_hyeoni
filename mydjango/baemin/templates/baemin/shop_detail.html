{% extends "baemin/base.html" %} 
{% load django_bootstrap5 %}
{% comment %} ì¥ê³ ì˜ ìƒì† {% endcomment %}

{% comment %} ìì‹ í…œí”Œë¦¿ì€ blockì„ ì¬ì •ì˜í•˜ì§€ ì•Šì€ ì½”ë“œëŠ” ë¬´ì‹œëœë‹¤. {% endcomment %}
{% block content  %}
    <div class="shop-detail">
      <img src="{{ shop.photo.url }}" alt="{{ shop.name }} width="200px" height="200px"">
      <h2>{{ shop.name }}</h2>
      <p class="description">{{ shop.description }}</p>
    </div>
    <a href="/baemin/{{ shop.pk }}/reviews/new/">ëŒ“ê¸€ ì“°ê¸°</a>

    <h3>ëŒ“ê¸€ ëª©ë¡</h3>

    {% for review in review_list %}
      <div class="review-wrap">
        {{ review.content }}
        ({{ review.rating }})
        <a href="/baemin/{{ shop.pk }}/reviews/{{ review.pk }}/edit/">
          ìˆ˜ì •ğŸ“Œ
        </a>
        <a href="/baemin/{{ shop.pk }}/reviews/{{ review.pk }}/delete/" class="btn-review-delete text-danger">ì‚­ì œğŸ“¥</a>
      </div>
      {% empty %}
      <div>ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤. ğŸ˜¥
      </div>
      {% endfor %}

      {% csrf_token %}
      <script>
        const csrf_token = document.querySelector("[name=csrfmiddlewaretoken]").value;
  
        const reviewWrapList = document.querySelectorAll(".review-wrap");
        /* for el in reviewWrapList */
        reviewWrapList.forEach((wrapEl) => {
          console.log("wrapEl :", wrapEl);
          const deleteBtnEl = wrapEl.querySelector(".btn-review-delete");
  
          console.log("deleteBtnEl.href :", deleteBtnEl.href);
  
          // deleteBtnEl; // <a> ìš”ì†Œë¥¼ í´ë¦­í–ˆì„ ë•Œì˜ ê¸°ë³¸ ë™ì‘ì€ ì§€ì • href ì£¼ì†Œë¡œ í˜ì´ì§€ ì´ë™
          deleteBtnEl.addEventListener("click", async function(event) {
            event.preventDefault();  // í˜„ì¬ ì´ë²¤íŠ¸ ë°œìƒ ìš”ì†Œì˜ ê¸°ë³¸ ë™ì‘ì„ ì·¨ì†Œí•©ë‹ˆë‹¤.
  
            // clickì— ëŒ€í•œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (event listener)
            // console.log('clicked :', event);
  
            if ( confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?") ) {
              // ìœ ì €ê°€ OK(í™•ì¸)í–ˆë‹¤ë©´?
              // ì§€ì • ì£¼ì†Œë¡œ POST ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤. (ì‚­ì œ ìš”ì²­)
              const res = await fetch(deleteBtnEl.href, {
                method: "POST",
                headers: {"X-CSRFToken": csrf_token},
              }); // Promise ê°ì²´
              console.log("res :", res);
              // TODO: ì‚­ì œë¨ ì‘ë‹µì„ ë°›ìœ¼ë©´, window.location.reload(); ìƒˆë¡œê³ ì¹¨ì„ í•´ë„ ë˜ê³ .
              // JSë¡œ ì§€ì • wrapElì„ deleteí•´ë„ ë©ë‹ˆë‹¤.
              wrapEl.remove();
            }
          });
        });
      </script>
{% endblock  %}